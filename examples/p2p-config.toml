# Example Fabrik configuration with P2P cache sharing enabled

[cache]
dir = ".fabrik/cache"
max_size = "20GB"
eviction_policy = "lfu"
default_ttl = "7d"

# P2P cache sharing configuration
[p2p]
# Enable P2P cache sharing
enabled = true

# Shared secret for HMAC authentication (minimum 16 characters)
# IMPORTANT: This secret should be shared among team members
# Store it securely (e.g., 1Password, environment variable)
secret = "my-team-secret-2024-fabrik"

# Advertise this instance on the local network via mDNS
advertise = true

# Discover other peers on the local network
discovery = true

# P2P protocol bind port (0 = random port, recommended for daemon mode)
bind_port = 7071

# Maximum number of peers to track
max_peers = 20

# Consent mode options:
# - "notify-once": Show notification first time, remember choice (recommended)
# - "notify-always": Show notification every time
# - "auto-approve": Automatically approve if secret is valid
# - "disabled": Never allow P2P requests
consent_mode = "notify-once"

# How long to wait for user to respond to consent notification
consent_timeout = "30s"

# Auto-approve requests from same user on different machines
auto_approve_same_user = true

# Request timeout (how long to wait for peer to respond)
request_timeout = "5s"

# Max concurrent peer requests
max_concurrent_requests = 5

# Regional cache (falls back to this if no P2P peers have the artifact)
[[upstream]]
url = "grpc://cache.tuist.io:7070"
timeout = "30s"
write_through = true

# S3 fallback (permanent storage)
[[upstream]]
url = "s3://my-bucket/cache/"
timeout = "60s"
permanent = true
region = "us-east-1"

# Build systems to enable
[build_systems]
enabled = ["gradle", "bazel", "nx"]

[observability]
log_level = "info"
log_format = "json"
