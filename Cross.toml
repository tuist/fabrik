# Cross.toml - Configuration for cross-compilation
# Install protoc 28.3 (same version as mise config) in all cross Docker images
#
# IMPORTANT: Cross-compilation runs ON x86_64 hosts, so protoc must be x86_64
# even when cross-compiling FOR ARM targets. Protoc runs during build.rs,
# which executes on the host, not the target architecture.

[build.env]
passthrough = ["PROTOC"]

# All targets use x86_64 protoc because cross builds run on x86_64 hosts
[target.x86_64-unknown-linux-gnu]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.x86_64-unknown-linux-musl]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.aarch64-unknown-linux-gnu]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.aarch64-unknown-linux-musl]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.armv7-unknown-linux-gnueabihf]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.armv7-unknown-linux-musleabihf]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]
