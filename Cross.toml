# Cross.toml - Configuration for cross-compilation
# Install protoc 28.3 (same version as mise config) in all cross Docker images

[build.env]
passthrough = ["PROTOC"]

# Pre-build script to install protoc 28.3 from GitHub releases
[target.x86_64-unknown-linux-gnu]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.x86_64-unknown-linux-musl]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-x86_64.zip",
    "unzip protoc-28.3-linux-x86_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-x86_64.zip",
]

[target.aarch64-unknown-linux-gnu]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-aarch_64.zip",
    "unzip protoc-28.3-linux-aarch_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-aarch_64.zip",
]

[target.aarch64-unknown-linux-musl]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-aarch_64.zip",
    "unzip protoc-28.3-linux-aarch_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-aarch_64.zip",
]

[target.armv7-unknown-linux-gnueabihf]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-aarch_64.zip",
    "unzip protoc-28.3-linux-aarch_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-aarch_64.zip",
]

[target.armv7-unknown-linux-musleabihf]
pre-build = [
    "apt-get update && apt-get install -y curl unzip",
    "curl -LO https://github.com/protocolbuffers/protobuf/releases/download/v28.3/protoc-28.3-linux-aarch_64.zip",
    "unzip protoc-28.3-linux-aarch_64.zip -d /usr/local",
    "chmod +x /usr/local/bin/protoc",
    "rm protoc-28.3-linux-aarch_64.zip",
]
